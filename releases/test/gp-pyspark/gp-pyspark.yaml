---
apiVersion: helm.fluxcd.io/v1
kind: HelmRelease
metadata:
  name: gp-pyspark
  namespace: pyspark
  annotations:
    fluxcd.io/automated: "true"
spec:
  releaseName: gp-pyspark
  chart:
    git: git@github.com:Git-Prime/gphelm-chart-repo.git
    path: charts/gp-pyspark/v0.0.1/
    version: 0.0.1
    ref: INFRA-915/add_pyspark_chart
  values:
    jobs:
      # Override jobs[0] in values.yaml
      - name: gp-pyspark
        image:
          repository: gp-docker.gitprime-ops.com/dev/gp-pyspark
          tag: 6c7d003e7d68726c88edd866bf5638503274c18c
          imagePullPolicy: Always
        env:
        - name: SYSTEM_ENV
          value: "sandbox-05"
        schedule: "0 3 * * *"
        command: ["/bin/bash"]
        args:
          - "-c"
          - "python driver.py '2019-01-01' '2019-10-31'"
        resources:
          limits:
            cpu: 6
            memory: 20Gi
          requests:
            cpu: 2
            memory: 8Gi
        failedJobsHistoryLimit: 1
        successfulJobsHistoryLimit: 3
        concurrencyPolicy: Forbid
        restartPolicy: Never
        suspend: true
